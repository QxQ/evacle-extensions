<!DOCTYPE html>
<html>
<head>
<script>


var info = {
  "poke"    :   2,              // poke version 2
  "width"   :   1,              // 406 px default width
  "height"  :   1,              // 200 px default height
  "path"    :   "widget.html",
  "v2"      :   {
                  "resize"    :   true,  // Set to true ONLY if you create a range below.
                  "min_width" :   1,     // 200 px min width
                  "max_width" :   2,     // 406 px max width
                  "min_height":   1,     // 200 px min height
                  "max_height":   2      // 200 px max height
                }
};

// Below is the required poke listener
// DO NOT MODIFY ANY OF THE BELOW CODE
chrome.extension.onRequestExternal.addListener(function(request, sender, sendResponse) {
  if(request === "mgmiemnjjchgkmgbeljfocdjjnpjnmcg-poke") {
    chrome.extension.sendRequest(
      sender.id,
      {
        head: "mgmiemnjjchgkmgbeljfocdjjnpjnmcg-pokeback",
        body: info,
      }
    );
  }
});
// Above is the required poke listener
// DO NOT MODIFY ANY OF THE ABOVE CODE


function changeIcon(tabId, selectInfo) {
	chrome.tabs.get(tabId, function(tab){
		if (tab.pinned) {
				chrome.browserAction.setIcon({path:"unpin.png"})
				chrome.browserAction.setTitle({title:"unpin tab"})
		} else {
				chrome.browserAction.setIcon({path:"pin.png"})
				chrome.browserAction.setTitle({title:"pin tab"})
		}
	});
}

chrome.tabs.query({active:true}, function(tabs) {
	changeIcon(tabs[0].id)
});

chrome.tabs.onActiveChanged.addListener(changeIcon);

chrome.browserAction.onClicked.addListener(function(tab) {
	chrome.tabs.update(tab.id, { pinned:(!tab.pinned) }, function(){} )
	changeIcon(tab.id)
});

chrome.extension.onRequest.addListener(
  function(request, sender, sendResponse) {
	if (sender.tab.url=='chrome://newtab/') {
		if (request.pinTab==true) {
			chrome.tabs.update(sender.tab.id, { pinned:(!sender.tab.pinned) }, function(){
				changeIcon(sender.tab.id,{})
			});
		}
	}
  });

</script>
</head>
</html>
<!-- vim: set sw=2 ts=2 et: -->
